<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://www.thymeleaf.org"
        layout:decorate="~{layout}">

<head>
    <title>Producer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
<section layout:fragment="content">
    <div class="container">
        <script type="application/javascript">
            //do the thing

            jQuery(document).ready(function()
            {
                var fieldNameCSV = "[[${producerMessage.propertyNameList}]]";

                var source = jQuery('#propertyFieldTemplate').html();
                var template = Handlebars.compile(source);

                var fieldNameArray = fieldNameCSV.split(",");

                var fieldHtml = "";

                for( index in fieldNameArray)
                {
                    var properties = {
                        propertyName: fieldNameArray[index]
                    };

                    fieldHtml += template(properties);
                }

                jQuery('#propertyContainer').append(fieldHtml);
            });

            sendKafkaMessage = function(){
                var messageProperties = jQuery('.propertyValue');
                var generatedMessageJson = "{\"messageMap\":{";


                var i = 0;
                for(i; i < messageProperties.length - 1; i++)
                {
                    generatedMessageJson += "\"" + messageProperties[i].id + "\":\"" + messageProperties[i].value + "\",";
                }
                generatedMessageJson += "\"" + messageProperties[i].id + "\":\"" + messageProperties[i].value + "\"}}";

                ApiClient.submitKafkaMessage([[${producer.id}]], generatedMessageJson, sentKafkaMessageCallback());

            };

            sentKafkaMessageCallback = function(){
                alert("Message Successfully added to Kafka bus!")
            };

        </script>

        <script id="propertyFieldTemplate" type="text/x-handlebars-template">
            <div class="custom-option">
                <label class="col-md-3 form-group-row">
                    <i>{{propertyName}}</i>
                </label>
                <input id="{{propertyName}}" class="propertyValue" type="text">
            </div>
        </script>

        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <i class="fa fa-align-justify"></i>
                        Producer <strong th:text="${producer.name}"></strong> for topic <strong th:text="${producer.topic}"></strong>
                    </div>
                    <h4>Fill in property values to construct a message to send to Kafka:</h4>
                    <div style="height: 600px" class="overflow-scroll" id="propertyContainer"></div>
                    <div style="padding-top: 15px" align="center">
                        <button class="btn btn-success" style="width:50%" id="sendMessageButton" onclick="sendKafkaMessage()"> Send Message to Kafka </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>