<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://www.thymeleaf.org"
        layout:decorate="~{layout}">

<head>
    <title>Message Format</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
<section layout:fragment="content">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <strong th:text="${viewForm.exists()} ? 'Edit' : 'Create'">Create</strong>
                        <span th:text="${viewForm.exists()} ? ${viewForm.name} : 'New View'"></span>
                    </div>
                    <form
                        th:action="@{/configuration/view/update}"
                        th:object="${viewForm}"
                        method="post" class="form-horizontal">
                        <div class="card-body">
                            <!-- Name -->
                            <div class="form-group row">
                                <label class="col-md-3 form-control-label" for="name">
                                    View Name
                                </label>
                                <div class="col-md-9">
                                    <input
                                        id="name" name="name" class="form-control" type="text"
                                        placeholder="A unique name to identify this view"
                                        th:errorclass="is-invalid"
                                        th:value="*{name}">
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                                </div>
                            </div>

                            <!-- Cluster -->
                            <div class="form-group row">
                                <label class="col-md-3 form-control-label" for="clusterId">
                                    Cluster
                                </label>
                                <option class="col-md-9">
                                    <select
                                        id="clusterId" name="clusterId" class="form-control"
                                        th:errorclass="is-invalid"
                                        th:field="*{clusterId}"
                                        onchange="jQuery.get(
                                            '/api/cluster/' + jQuery('#clusterId').val() + '/topics/list',
                                            function(topicList) {
                                                jQuery('#topic').empty();
                                                jQuery('#topic').removeAttr('disabled');
                                                jQuery('#topic').append($('<option></option>')
                                                                .attr('value', '!')
                                                                .text('Please select a topic')
                                                            );
                                                jQuery.each(topicList, function (index, topic) {
                                                    jQuery('#topic')
                                                        .append(
                                                            $('<option></option>')
                                                                .attr('value', topic.name)
                                                                .text(topic.name)
                                                            );
                                                });
                                            });">
                                        <option value="">Please select a cluster</option>
                                        <option th:each="cluster : ${clusters}"
                                                th:value="${cluster.id}" th:text="${cluster.name}">Cluster Name</option>
                                    </select>
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('clusterId')}" th:errors="*{clusterId}"></div>
                                </div>

                                <!-- Topic -->
                                <div class="form-group row">
                                    <label class="col-md-3 form-control-label" for="topic">
                                        Topic
                                    </label>
                                    <div class="col-md-9">
                                        <select
                                            id="topic" name="topic" class="form-control"
                                            th:attr="disabled=${topics.isEmpty()}? 'disabled'"
                                            th:errorclass="is-invalid"
                                            th:field="*{topic}">
                                            <option value="!">Please select a topic</option>
                                            <option th:if="${topics} != null" th:each="topic : ${topics}"
                                                    th:value="${topic.name}" th:text="${topic.name}">Topic Name</option>
                                        </select>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('topic')}" th:errors="*{topic}"></div>
                                    </div>
                                </div>

                                <!-- Key Message Formats -->
                                <div class="form-group row">
                                    <label class="col-md-3 form-control-label" for="keyMessageFormatId">
                                        Message Format for Keys
                                    </label>
                                    <div class="col-md-9">
                                        <select
                                                id="keyMessageFormatId" name="keyMessageFormatId" class="form-control"
                                                th:errorclass="is-invalid"
                                                th:field="*{keyMessageFormatId}">
                                            <option value="">Please select a message format</option>
                                            <optgroup label="Default Formats">
                                                <option th:each="messageFormat : ${defaultMessageFormats}"
                                                        th:value="${messageFormat.id}" th:text="${messageFormat.name}">Format Name</option>
                                            </optgroup>
                                            <optgroup label="Custom Formats">
                                                <option th:each="messageFormat : ${customMessageFormats}"
                                                        th:value="${messageFormat.id}" th:text="${messageFormat.name}">Format Name</option>
                                            </optgroup>
                                        </select>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('keyMessageFormatId')}" th:errors="*{keyMessageFormatId}"/>
                                    </div>
                                </div>

                                <!-- Key Message Formats -->
                                <div class="form-group row">
                                    <label class="col-md-3 form-control-label" for="valueMessageFormatId">
                                        Message Format for Values
                                    </label>
                                    <div class="col-md-9">
                                        <select
                                                id="valueMessageFormatId" name="valueMessageFormatId" class="form-control"
                                                th:errorclass="is-invalid"
                                                th:field="*{valueMessageFormatId}">
                                            <option value="">Please select a message format</option>
                                            <optgroup label="Default Formats">
                                                <option th:each="messageFormat : ${defaultMessageFormats}"
                                                        th:value="${messageFormat.id}" th:text="${messageFormat.name}">Format Name</option>
                                            </optgroup>
                                            <optgroup label="Custom Formats">
                                                <option th:each="messageFormat : ${customMessageFormats}"
                                                        th:value="${messageFormat.id}" th:text="${messageFormat.name}">Format Name</option>
                                            </optgroup>
                                        </select>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('valueMessageFormatId')}" th:errors="*{valueMessageFormatId}"/>
                                    </div>
                                </div>
                            </div>

                            <div class="card-footer">
                                <input type="hidden" name="id" th:if="${viewForm.exists()}" th:field="*{id}"></input>
                                <button type="submit" class="btn btn-sm btn-primary">
                                    <i class="fa fa-dot-circle-o"></i>
                                    Submit
                                </button>
                                <a class="btn btn-sm btn-danger" href="/configuration/view" role="button">
                                    <i class="fa fa-ban"></i>
                                    Cancel
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

</body>
</html>